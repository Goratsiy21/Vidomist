<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Таблиця з Firebase</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js"></script>
    <script>
        // Конфігурація Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyD3lDodPNLj9r4BcoLTqx7ixPDsHV4p96I",
            authDomain: "vidomist.firebaseapp.com",
            projectId: "vidomist",
            storageBucket: "vidomist.appspot.com",
            messagingSenderId: "55747512921",
            appId: "1:55747512921:web:6af7fb59c0a3e26442ff48"
        };

        // Ініціалізація Firebase
        firebase.initializeApp(firebaseConfig);
        
        // Ініціалізація Firestore
        const db = firebase.firestore();

        // Функція для збереження даних у Firestore
        function saveData() {
            let tableData = [];
            const rows = document.querySelectorAll("tbody tr");

            rows.forEach((row, rowIndex) => {
                let rowData = {};
                row.querySelectorAll("input").forEach((cell, cellIndex) => {
                    rowData[`cell_${rowIndex + 1}_${cellIndex + 1}`] = cell.value;
                });
                tableData.push(rowData);
            });

            // Зберегти дані у Firestore
            db.collection("tableData").add({
                rows: tableData,
                timestamp: new Date()
            })
            .then(() => {
                alert("Дані успішно збережено у Firebase!");
            })
            .catch((error) => {
                console.error("Помилка збереження:", error);
            });
        }

        // Функція для отримання даних з Firestore і відображення їх у таблиці
        function loadData() {
            console.log("Виклик функції loadData()"); // Перевірка виклику функції
            db.collection("tableData").orderBy("timestamp", "desc").limit(1).get()
            .then((querySnapshot) => {
                if (!querySnapshot.empty) {
                    console.log("Дані знайдено"); // Перевірка наявності даних
                    querySnapshot.forEach((doc) => {
                        const data = doc.data().rows;
                        const rows = document.querySelectorAll("tbody tr");

                        if (data && data.length > 0) {
                            data.forEach((rowData, rowIndex) => {
                                const row = rows[rowIndex];
                                Object.keys(rowData).forEach((key, cellIndex) => {
                                    row.querySelectorAll("input")[cellIndex].value = rowData[key];
                                });
                            });
                        } else {
                            console.log("Дані відсутні або порожні");
                        }
                    });
                } else {
                    console.log("Запит не знайшов даних у Firestore");
                }
            })
            .catch((error) => {
                console.error("Помилка отримання даних:", error);
            });
        }
    </script>
</head>
<body>
    <h2>Таблиця для введення інформації</h2>
    <form>
        <table border="1" cellpadding="5" cellspacing="0">
            <thead>
                <tr>
                    <th>Стовпець 1</th>
                    <th>Стовпець 2</th>
                    <th>Стовпець 3</th>
                    <!-- Заголовки для всіх стовпців до 22 -->
                    <th>Стовпець 22</th>
                </tr>
            </thead>
            <tbody>
                <!-- 30 рядків -->
                <tr>
                    <td><input type="text" name="cell1_1"></td>
                    <td><input type="text" name="cell1_2"></td>
                    <td><input type="text" name="cell1_3"></td>
                    <!-- Додати для кожного стовпця -->
                    <td><input type="text" name="cell1_22"></td>
                </tr>
                <!-- Повторити рядки до 30 -->
            </tbody>
        </table>
        <br>
        <button type="button" onclick="saveData()">Зберегти інформацію</button>
        <!-- Додати кнопку для витягування даних з Firebase -->
        <button type="button" onclick="loadData()">Витягнути дані з Firebase</button>
    </form>
</body>
</html>
